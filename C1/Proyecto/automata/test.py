from automata.fa.dfa import DFA
import pandas as pd
import tabula


dfa=DFA(
    states= {'q0','q1','q2','q3','q4','q5','q6','q7','q8','q9','q10','q11','q12','q13','q14','q15','q16','q17','q18','q19','q20','q21','q22','q23','q24','q25','q26','q27','q28','q29','q30','q31','q32','q33','q34','q35','q36','q37','q38','q39','q40','q41','q42','q43','q44','q45','q46','q47','q48','q49','q50','q51','q52','q53','q54','q55','q56','q57','q58','q59','q60','q61','q62','q63','q64','q65','q66','q67','q68','q69','q70','q71','q72','q73','q74','q75','q76','q77','q78','q79','q80','q81','q82','q83','q84','q85','q86','q87','q88','q89','q90','q91','q92','q93','q94','q95','q96','q97','q98','q99','q100','q101','q102','q103','q104','q105','q106','q107','q108','q109','q110','q111','q112','q113','q114','q115','q116','q117','q118','q119','q120','q121','q122','q123','q124','q125','q126','q127','q128','q129','q130','q131','q132','q133','q134','q135','q136','q137','q138','q139','q140','q141','q142','q143','q144','q145','q146','q147','q148','q149','q150','q151','q152','q153','q154','q155','q156','q157','q158','q159','q160','q161','q162','q163','q164','q165','q166','q167','q168','q169','q170','q171','q172','q173','q174','q175','q176','q177','q178','q179','q180','q181','q182','q183','q184','q185','q186','q187','q188','q189','q190','q191','q192','q193','q194','q195','q196','q197','q198','q199','q200','q201','q202','q203','q204','q205','q206','q207','q208','q209','q210','q211','q212',},
    input_symbols={'+','"','#',' ','1','2','3','4','5','6','7','8','9','0','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','_','/','(',')',',','-','.','$','á','é','í','ó','ú','Í','Ó','Ú','Á','É','ñ','Ñ','ü','Ü',},
    transitions={
        #CONTABILIDAD
        'q0':{'1':'q1','2':'q19','P':'q69'},
        'q1':{'2':'q2'},
        'q2':{'4':'q3','5':'q3'},
        'q3':{'1':'q4','2':'q4','3':'q4','4':'q4','5':'q4','6':'q4','7':'q4','8':'q4','9':'q4','0':'q4'},
        'q4':{' ':'q5'},
        'q5':{'1':'q6','3':'q6','9':'q6','2':'q6'},
        'q6':{'1':'q7','2':'q7','4':'q7','5':'q7','6':'q7','7':'q7','8':'q7','9':'q7','0':'q7'},
        'q7':{'4':'q8','5':'q8','0':'q8'},
        'q8':{'7':'q9','8':'q9','9':'q9','0':'q9'},
        'q9':{'1':'q10','2':'q10','3':'q10','0':'q10'},
        'q10':{'1':'q11','2':'q11','3':'q11','4':'q11','5':'q11','6':'q11','7':'q11','8':'q11','9':'q11','0':'q11'},
        'q11':{'1':'q12','2':'q12','3':'q12','4':'q12','5':'q12','6':'q12','7':'q12','8':'q12','9':'q12','0':'q12'},
        'q12':{'1':'q13','2':'q13','3':'q13','4':'q13','5':'q13','6':'q13','7':'q13','8':'q13','9':'q13','0':'q13'},
        'q13':{' ':'q14'},
        'q14':{'0':'q15'},
        'q15':{'0':'q16'},
        'q16':{'1':'q17','2':'q17','3':'q17','4':'q17','5':'q17','6':'q17','7':'q17','8':'q17','9':'q17','0':'q17'},
        'q17':{'1':'q18','2':'q18','3':'q18','4':'q18','5':'q18','6':'q18','7':'q18','8':'q18','9':'q18','0':'q18'},
        'q18':{',':'q78'},
        'q19':{'1':'q20'},
        'q20':{'1':'q21',},
        'q21':{'2':'q22','5':'q38'},
        'q22':{'0':'q23'},
        'q23':{'0':'q24'},
        'q24':{'4':'q25',},
        'q25':{'0':'q26'},
        'q26':{'1':'q27'},
        'q27':{'1':'q28','2':'q53'},
        'q28':{'P':'q29'},
        'q29':{'D':'q30'},
        'q30':{'I':'q31'},
        'q31':{'1':'q32'},
        'q32':{'0':'q33'},
        'q33':{'0':'q34'},
        'q34':{'0':'q35'},
        'q35':{'8':'q36'},
        'q36':{'6':'q37'},
        'q37':{',':'q78'},
        'q38':{'0':'q39'},
        'q39':{'0':'q40'},
        'q40':{'4':'q41'},
        'q41':{'0':'q42'},
        'q42':{'1':'q43'},
        'q43':{'2':'q44'},
        'q44':{'P':'q45'},
        'q45':{'P':'q46'},
        'q46':{'A':'q47'},
        'q47':{'1':'q48'},
        'q48':{'0':'q49'},
        'q49':{'0':'q50'},
        'q50':{'0':'q51'},
        'q51':{'4':'q52'},
        'q52':{'9':'q37'},
        'q53':{'P':'q54'},
        'q54':{'P':'q55','D':'q62'},
        'q55':{'A':'q56'},
        'q56':{'1':'q57'},
        'q57':{'0':'q58'},
        'q58':{'0':'q59'},
        'q59':{'0':'q60'},
        'q60':{'2':'q61','4':'q61'},
        'q61':{'8':'q37'},
        'q62':{'I':'q63'},
        'q63':{'1':'q64'},
        'q64':{'0':'q65'},
        'q65':{'0':'q66'},
        'q66':{'1':'q67'},
        'q67':{'5':'q68'},
        'q68':{'5':'q37'},
        'q69':{'F':'q70'},
        'q70':{'C':'q71'},
        'q71':{'E':'q72'},
        'q72':{' ':'q73'},
        'q73':{'2':'q74'},
        'q74':{'0':'q75'},
        'q75':{'1':'q76'},
        'q76':{'9':'q77'},
        'q77':{',':'q78'},#FINAL STATE 
        #AÑO DE COMPRA







        'q78':{'1':'q79','2':'q80'},
        'q79':{'1':'q81','2':'q81','3':'q81','4':'q81','5':'q81','6':'q81','7':'q81','8':'q81','9':'q81','0':'q81'},
        'q80':{'1':'q81','2':'q81','0':'q81'},
        'q81':{',':'q82'},#FINAL STATE 









        #CODIGO
        'q82':{'6':'q83'},
        'q83':{'0':'q84'},
        'q84':{'4':'q85'},
        'q85':{'0':'q86'},
        'q86':{'0':'q87'},
        'q87':{'1':'q88','2':'q89'},
        'q88':{'1':'q90','2':'q90','0':'q90','3':'q90','4':'q90','5':'q90','6':'q90','7':'q90','8':'q90','9':'q90'},
        'q89':{'1':'q90','2':'q90','0':'q90'},
        'q90':{'1':'q91'},
        'q91':{'0':'q92','1':'q92'},
        'q92':{'0':'q93'},
        'q93':{'1':'q94','2':'q94','3':'q94','4':'q94','5':'q94','6':'q94','7':'q94','8':'q94','9':'q94','0':'q94'},
        'q94':{'0':'q95','1':'q96','2':'q96','3':'q96','4':'q96','5':'q96','6':'q96','7':'q96','8':'q96','9':'q96'},
        'q95':{'1':'q97','2':'q97','3':'q97','4':'q97','5':'q97','6':'q97','7':'q97','8':'q97','9':'q97','0':'q97'},
        'q96':{'1':'q97','2':'q97','3':'q97','4':'q97','5':'q97','6':'q97','7':'q97','8':'q97','9':'q97','0':'q97'},
        'q97':{',':'q98',},#FINAL STATE 





        #CODIGO SISMOB WEB
        'q98':{'6':'q99','"':'q113'},
        'q99':{'0':'q100'},
        'q100':{'4':'q101'},
        'q101':{'0':'q102'},
        'q102':{'0':'q103'},
        'q103':{'1':'q104','2':'q105'},
        'q104':{'1':'q106','2':'q106','3':'q106','4':'q106','5':'q106','6':'q106','7':'q106','8':'q106','9':'q106','0':'q106'},
        'q105':{'0':'q106','1':'q106','2':'q106'},
        'q106':{'0':'q107'},
        'q107':{'0':'q108'},
        'q108':{'0':'q109'},
        'q109':{'0':'q110','1':'q110','2':'q110','3':'q110','4':'q110','5':'q110','6':'q110','7':'q110','8':'q110','9':'q110'},
        'q110':{'0':'q111','1':'q112','2':'q112','3':'q112','4':'q112','5':'q112','6':'q112','7':'q112','8':'q112','9':'q112'},
        'q111':{'1':'q116','2':'q116','3':'q116','4':'q116','5':'q116','6':'q116','7':'q116','8':'q116','9':'q116','0':'q116'},
        'q112':{'1':'q116','2':'q116','3':'q116','4':'q116','5':'q116','6':'q116','7':'q116','8':'q116','9':'q116','0':'q116'},
        'q113':{'#':'q114'},
        'q114':{'N':'q115'},
        'q115':{'/':'q133'},
        'q116':{',':'q117'},#FINAL STATE 
        #DESCRIPCION DEL BIEN
        'q117':{'1':'q118','A':'q119','B':'q119','C':'q119','D':'q119','E':'q119','F':'q119','G':'q119','H':'q119','I':'q119','J':'q119','K':'q119','L':'q119','M':'q119','N':'q119','O':'q119','P':'q119','Q':'q119','R':'q119','S':'q119','T':'q119','U':'q119','V':'q119','W':'q119','X':'q119','Y':'q119','Z':'q119','"':'q119'},
        'q118':{' ':'q119'},
        'q119':{' ':'q119','+':'q119',',':'q135','A':'q119','B':'q119','C':'q119','D':'q119','E':'q119','F':'q119','G':'q119','H':'q119','I':'q119','J':'q119','K':'q119','L':'q119','M':'q119','N':'q119','O':'q119','P':'q119','Q':'q119','R':'q119','S':'q119','T':'q119','U':'q119','V':'q119','W':'q119','X':'q119','Y':'q119','Z':'q119','a':'q119','b':'q119','c':'q119','d':'q119','e':'q119','f':'q119','g':'q119','h':'q119','i':'q119','j':'q119','k':'q119','l':'q119','m':'q119','n':'q119','o':'q119','p':'q119','q':'q119','r':'q119','s':'q119','t':'q119','u':'q119','v':'q119','w':'q119','x':'q119','y':'q119','z':'q119','0':'q119','1':'q119','2':'q119','3':'q119','4':'q119','5':'q119','6':'q119','7':'q119','8':'q119','9':'q119','"':'q119','(':'q119',')':'q119','-':'q119','.':'q119','á':'q119','é':'q119','í':'q119','ó':'q119','ú':'q119','ñ':'q119','ü':'q119','Á':'q119','É':'q119','Í':'q119','Ó':'q119','Ú':'q119','Ñ':'q119','Ü':'q119','"':'q119','/':'q119'},
        #FINAL STATE
        #VALOR EN LIBROS
        'q120':{'$':'q121'},
        'q121':{' ':'q122'},
        'q122':{' ':'q122','1':'q123','2':'q123','3':'q123','4':'q123','5':'q123','6':'q123','7':'q123','8':'q123','9':'q123',},
        'q123':{'1':'q124','2':'q124','3':'q124','4':'q124','5':'q124','6':'q124','7':'q124','8':'q124','9':'q124','0':'q124',',':'q126'},
        'q124':{'1':'q125','2':'q125','3':'q125','4':'q125','5':'q125','6':'q125','7':'q125','8':'q125','9':'q125','0':'q125',',':'q126'},
        'q125':{',':'q126'},
        'q126':{'1':'q127','2':'q127','3':'q127','4':'q127','5':'q127','6':'q127','7':'q127','8':'q127','9':'q127','0':'q127'},
        'q127':{'1':'q128','2':'q128','3':'q128','4':'q128','5':'q128','6':'q128','7':'q128','8':'q128','9':'q128','0':'q128'},
        'q128':{'1':'q129','2':'q129','3':'q129','4':'q129','5':'q129','6':'q129','7':'q129','8':'q129','9':'q129','0':'q129'},
        'q129':{'.':'q130',',':'q126'},
        'q130':{'1':'q131','2':'q131','3':'q131','4':'q131','5':'q131','6':'q131','7':'q131','8':'q131','9':'q131','0':'q131'},
        'q131':{'1':'q132','2':'q132','3':'q132','4':'q132','5':'q132','6':'q132','7':'q132','8':'q132','9':'q132','0':'q132'},
        'q132':{'"':'q136'},
        'q133':{'A':'q134'},
        'q134':{'"':'q116'},
        'q135':{'"':'q120',' ':'q119'},
        'q136':{',':'q137'},#FINAL STATE 
        #PORCENTAJE DE DEPRECIACION
        'q137':{'1':'q138','2':'q138','3':'q138','4':'q138','5':'q138','6':'q138','7':'q138','8':'q138','9':'q138','0':'q138'},
        'q138':{'1':'q139','2':'q139','3':'q139','4':'q139','5':'q139','6':'q139','7':'q139','8':'q139','9':'q139','0':'q139','.':'q141',',':'q143'},
        'q139':{'.':'q140',',':'q143'},
        'q140':{'1':'q141','2':'q141','3':'q141','4':'q141','5':'q141','6':'q141','7':'q141','8':'q141','9':'q141','0':'q141'},
        'q141':{'1':'q142','2':'q142','3':'q142','4':'q142','5':'q142','6':'q142','7':'q142','8':'q142','9':'q142','0':'q142',',':'q143'},
        'q142':{',':'q143'},#FINAL STATE 
        #AÑOS TRANSCURRIDOS
        'q143':{'1':'q144','2':'q144','3':'q144','4':'q144','5':'q144','6':'q144','7':'q144','8':'q144','9':'q144','0':'q144'},
        'q144':{',':'q145'},#FINAL STATE 
        #PRECIO DEPRECIADO
        'q145':{'"':'q146'},
        'q146':{'$':'q147'},
        'q147':{' ':'q147','1':'q148','2':'q148','3':'q148','4':'q148','5':'q148','6':'q148','7':'q148','8':'q148','9':'q148'},
        'q148':{'1':'q149','2':'q149','3':'q149','4':'q149','5':'q149','6':'q149','7':'q149','8':'q149','9':'q149','0':'q149',',':'q151'},
        'q149':{'1':'q150','2':'q150','3':'q150','4':'q150','5':'q150','6':'q150','7':'q150','8':'q150','9':'q150','0':'q150',',':'q151'},
        'q150':{',':'q151'},
        'q151':{'1':'q152','2':'q152','3':'q152','4':'q152','5':'q152','6':'q152','7':'q152','8':'q152','9':'q152','0':'q152'},
        'q152':{'1':'q153','2':'q153','3':'q153','4':'q153','5':'q153','6':'q153','7':'q153','8':'q153','9':'q153','0':'q153'},
        'q153':{'1':'q154','2':'q154','3':'q154','4':'q154','5':'q154','6':'q154','7':'q154','8':'q154','9':'q154','0':'q154'},
        'q154':{'.':'q155',',':'q151'},
        'q155':{'1':'q156','2':'q156','3':'q156','4':'q156','5':'q156','6':'q156','7':'q156','8':'q156','9':'q156','0':'q156'},
        'q156':{'1':'q157','2':'q157','3':'q157','4':'q157','5':'q157','6':'q157','7':'q157','8':'q157','9':'q157','0':'q157'},
        'q157':{'"':'q158'},
        'q158':{',':'q159'},#FINAL STATE 
        #TOTAL CONTABLE
        'q159':{'"':'q160'},
        'q160':{'$':'q161'},
        'q161':{' ':'q161','1':'q162','2':'q162','3':'q162','4':'q162','5':'q162','6':'q162','7':'q162','8':'q162','9':'q162'},
        'q162':{'1':'q163','2':'q163','3':'q163','4':'q163','5':'q163','6':'q163','7':'q163','8':'q163','9':'q163','0':'q163',',':'q165'},
        'q163':{'1':'q164','2':'q164','3':'q164','4':'q164','5':'q164','6':'q164','7':'q164','8':'q164','9':'q164','0':'q164',',':'q165'},
        'q164':{',':'q165'},
        'q165':{'1':'q166','2':'q166','3':'q166','4':'q166','5':'q166','6':'q166','7':'q166','8':'q166','9':'q166','0':'q166'},
        'q166':{'1':'q167','2':'q167','3':'q167','4':'q167','5':'q167','6':'q167','7':'q167','8':'q167','9':'q167','0':'q167'},
        'q167':{'1':'q168','2':'q168','3':'q168','4':'q168','5':'q168','6':'q168','7':'q168','8':'q168','9':'q168','0':'q168'},
        'q168':{'.':'q169',',':'q165'},
        'q169':{'1':'q170','2':'q170','3':'q170','4':'q170','5':'q170','6':'q170','7':'q170','8':'q170','9':'q170','0':'q170'},
        'q170':{'1':'q171','2':'q171','3':'q171','4':'q171','5':'q171','6':'q171','7':'q171','8':'q171','9':'q171','0':'q171'},
        'q171':{'"':'q172'},
        'q172':{},#FINAL STATE  
    },
    allow_partial=True,
    initial_state='q0',
    final_states={'q18','q37','q77','q81','q97','q116','q119','q136','q122','q144','q158','q172'}
)
my_input_str=""
i=0
# with open('./C1/Proyecto/automata/1.txt') as f:
#     # my_imput_str=""
#     data_txt=[line for line in f.readlines()]
#     for line in data_txt:
#         data_str=(data_txt[i])
#         my_input_str=data_str.strip("\n")
#         print(i+1) 
#         i=i+1   
#         if dfa.accepts_input(my_input_str):
#             print("Cadena aceptada")    
#             # pass
#         else:
#             print(i)
#             print('rejected')

 
# #Convert PDF into txt file, format csv
# tabula.convert_into("./C1/Proyecto/automata/1.pdf", "./C1/Proyecto/automata/1.txt",output_format="csv", pages='all',area=[140,12.75,790.5,950])
# #Create headers
# with open('./C1/Proyecto/automata/2.txt', 'w',encoding="utf-8") as ftemp:
#     ftemp.write('CONTABILIDAD,AÑO DE COMPRA,CODIGO,CÓDIGO SISMOB WEB,DESCRIPCION DEL BIEN,VALOR EN LIBROS,PORCENTAJE DE DEPRECIACIÓN, AÑOS TRANSCURRIDOS, PRECIO DEPRECIADO, TOTAL CONTABLE')
# #Read txt file and convert to csv
# with open('./C1/Proyecto/automata/1.txt') as f:
#     # my_imput_str=""
#     data_txt=[line for line in f.readlines()]
#     for line in data_txt:
#         data_str=(data_txt[i])
#         my_input_str=data_str.strip("\n")
#         print(i+1) 
#         i=i+1   
#         if dfa.accepts_input(my_input_str):
#             print("Cadena aceptada")    
#             # pass
#         else:
#             print(i)
#             print('rejected') 
#         #Create temporal file
#         with open('./C1/Proyecto/automata/2.txt','a',encoding="utf-8") as f:
#             f.write("\n")
#             f.write(my_input_str)
#Convert txt to csv

# def comprobacion():
#     #Read txt file and convert to csv
#     with open('./C1/Proyecto/automata/1.txt') as f:
#         # my_imput_str=""
#         data_txt=[line for line in f.readlines()]
#         for line in data_txt:
#             data_str=(data_txt[i])
#             my_input_str=data_str.strip("\n")
#             print(i+1) 
#             i=i+1   
#             if dfa.accepts_input(my_input_str):
#                 print("Cadena aceptada")    
#                # pass
#             else:
#                 print(i)
#                 print('rejected') 
#             #Create temporal file
#             with open('./C1/Proyecto/automata/2.txt','a',encoding="utf-8") as f:
#                 f.write("\n")
#                 f.write(my_input_str)
#                 read_file = pd.read_csv ('./C1/Proyecto/automata/2.txt')
#                 read_file.to_csv ('./C1/Proyecto/automata/1.csv', index=None, header=['CONTABILIDAD','AÑO DE COMPRA','CODIGO','CÓDIGO SISMOB WEB','DESCRIPCION DEL BIEN','VALOR EN LIBROS','PORCENTAJE DE DEPRECIACIÓN', 'AÑOS TRANSCURRIDOS', 'PRECIO DEPRECIADO', 'TOTAL CONTABLE'],encoding='latin1',mode='w')

# # comprobacion()
# if dfa.accepts_input('1241 31582520 0002,20,6040020100129,6040020000100'):
#     print("Cadena aceptada")  
# else:
#     print('rejected')  
#     # pass
# print(dfa.read_input_stepwise('2112004012PDI100155'))
# print(dfa.show_diagram())

# print(dfa.validate_input('0111', step=True))